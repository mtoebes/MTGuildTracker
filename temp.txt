
function get_loot_history_date(date_string)
	local y1, m1, d1, h1, min1, s1 = string.match(date_string,  '^(%d+)-(%d+)-(%d+) (%d+):(%d+):(%d+)$' )
	local date_tbl = { day = d1, month = m1, year = y1 }
	local date_time = os.time( date_tbl )
	local date = os.date( "%d/%m/%Y", date_time )
	return date
end

function GetTargetDate(start_date, days_ago)
	if start_date is nil then
		start_date - os.time()
	end

	local d1, m1, y1 = string.match(today,  '^(%d%d)/(%d%d)/(%d%d%d%d)$' )

	local start_date_tbl = { day = d1, month = m1, year = y1 }
	local last_date_tbl = { day = (d1 - days_ago), month = m1, year = y1 }
	local last_date_time = os.time( last_date_tbl )
	local last_date = os.date( "%y-%m-%d", last_date_time )
end

function GetPlayerLootCount_DaysAgo(player_name, start_date, days_ago)
	local loot_count = 0
	local target_date = GetTargetDate(start_date, days_ago)
	for i,n in ipairs(loothistory_tbl) do
		if (n.player_name == player_name) and (n.date >= target_date) then
			loot_count = loot_count + 1
		end
	end

	return loot_count
end

function GetPlayerLootCount(player_name)
	start_date = os.time()

	loot_count_table = {}
	for i,n in ipairs(week_list) do
		local loot_count = GetPlayerLootCount_DaysAgo(start_date, n*7)
		loot_count_table[n] = loot_count
	end

	return loot_count_table
end

function test(player_name)
	local loot_count_table = GetPlayerLootCount(player_name)

	for i,n in ipairs(GetPlayerLootCount) do
		local loot_count = loot_count_table[i]
		getglobal("MemeTracker_RecipientListItem"..line.."TextLootCount"..i):SetText(loot_count)
	end
end
